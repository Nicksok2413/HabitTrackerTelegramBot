#!/bin/sh

# ==============================================================================
# Entrypoint-скрипт для контейнера Телеграм-бота
# Выполняет команды, необходимые перед запуском основного процесса
# ==============================================================================

# Выход при ошибке (fail fast)
set -e

# Устанавливаем права на логи (если том смонтирован)
# Указываем пользователя и группу, под которыми будет работать приложение
APP_USER=appuser
APP_GROUP=appgroup

# Устанавливаем права на логи (если том смонтирован)
# Если папка logs существует, меняем владельца
# Используем chown для изменения владельца точки монтирования тома
# Делаем это под root перед понижением привилегий
if [ -d "/logs" ]; then
    echo "-> (Bot Entrypoint) Выдача прав на /logs..."
    chown -R "${APP_USER}:${APP_GROUP}" /logs
    echo "-> (Bot Entrypoint) Права установлены."
fi

# Запускаем команду, переданную в контейнер, под пользователем appuser
exec su-exec "${APP_USER}" "$@"